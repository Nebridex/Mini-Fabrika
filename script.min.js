(function(){
  function qs(s,c){return (c||document).querySelector(s)}
  function qsa(s,c){return Array.from((c||document).querySelectorAll(s))}

  document.addEventListener('DOMContentLoaded',function(){
    var toggle=qs('.menu-toggle');
    var nav=qs('nav');
    if(toggle&&nav){
      toggle.addEventListener('click',function(){
        var open=nav.classList.toggle('open');
        toggle.setAttribute('aria-expanded',open?'true':'false');
      });
    }

    var params=new URLSearchParams(window.location.search);
    var sentBanner=qs('[data-sent-banner]');
    if(sentBanner&&params.get('sent')==='1'){sentBanner.hidden=false;}

    var modelName=params.get('model');
    var modelLink=params.get('link');
    var modelNameInput=qs('#modelAdi');
    var modelLinkInput=qs('#modelLink');
    if(modelName&&modelNameInput){modelNameInput.value=modelName;}
    if(modelLink&&modelLinkInput){modelLinkInput.value=modelLink;}

    qsa('form[data-formsubmit]').forEach(function(form){
      form.addEventListener('submit',function(e){
        var honey=qs('input[name="_honey"]',form);
        if(honey&&honey.value.trim()!==''){e.preventDefault();return;}

        var requiredIds=['adSoyad','email','modelLink','adet'];
        for(var i=0;i<requiredIds.length;i++){
          var field=qs('#'+requiredIds[i],form);
          if(field&&!field.value.trim()){
            e.preventDefault();
            field.reportValidity();
            return;
          }
        }

        var email=qs('input[type="email"]',form);
        if(email&&!email.value.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){
          e.preventDefault();
          email.setCustomValidity('Lütfen geçerli bir e-posta adresi girin.');
          email.reportValidity();
          return;
        }
        if(email){email.setCustomValidity('');}

        if(!form.checkValidity()){
          e.preventDefault();
          form.reportValidity();
        }
      });
    });

    if(document.body.dataset.redirectHome==='true'){
      setTimeout(function(){window.location.href='index.html';},2000);
    }
  });
})();
