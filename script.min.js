(function(){
  function qs(sel,ctx){return (ctx||document).querySelector(sel)}
  function qsa(sel,ctx){return Array.from((ctx||document).querySelectorAll(sel))}

  document.addEventListener('DOMContentLoaded',function(){
    var toggle=qs('.menu-toggle');
    var nav=qs('nav');
    if(toggle&&nav){
      toggle.addEventListener('click',function(){
        var open=nav.classList.toggle('open');
        toggle.setAttribute('aria-expanded',open?'true':'false');
      });
    }

    var params=new URLSearchParams(window.location.search);
    var sentBanner=qs('[data-sent-banner]');
    if(sentBanner&&params.get('sent')==='1'){sentBanner.hidden=false;}

    qsa('form[data-formsubmit]').forEach(function(form){
      form.addEventListener('submit',function(e){
        var honey=qs('input[name="_honey"]',form);
        if(honey&&honey.value.trim()!==''){e.preventDefault();return;}

        var email=qs('input[type="email"]',form);
        if(email&&!email.value.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){
          e.preventDefault();
          email.setCustomValidity('Lütfen geçerli bir e-posta adresi girin.');
          email.reportValidity();
          return;
        }
        if(email){email.setCustomValidity('');}

        if(!form.checkValidity()){
          e.preventDefault();
          form.reportValidity();
        }
      });
    });

    if(document.body.dataset.redirectHome==='true'){
      setTimeout(function(){window.location.href='index.html';},2000);
    }
  });
})();
